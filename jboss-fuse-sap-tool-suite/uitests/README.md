# JBoss Tools Fuse SAP UI Tests

## Structure

 - uitests/plugins/org.jboss.tools.fuse.sap.reddeer
   RedDeer framework based on JBoss Tools Fuse SAP
 - uitests/tests/org.jboss.tools.fuse.sap.ui.bot.tests
   UI bot tests based on the above RedDeer framework for JBoss Tools Fuse SAP

## Prerequistes

 - an update site which includes bundled SAP libraries, e.g. the one generated by Import wizard in IDE when you install the SAP Tooling
   - the update site is specified by -Dtest.sapRepository
 - a runing SAP instance
   - host and credentials are sprecified by -Drd.config
 - optionaly some VNC server + viewer (e.g. [TigerVNC](http://tigervnc.org/)
   - we recommend executing UI tests in a separated display

### Example of RedDeer configuration file

```
org.jboss.tools.fuse.sap.reddeer.requirement.SAPRequirement.SAP:
- destination:
    name: testDest
    ashost: sap.example.com
    sysnr: '00'
    client: 200
    passwd: PASSWROD_123
    password: PASSWORD_123
    user: USER_123
    userName: USER_123
    lang: en
  server:
    name: testServer
    destination: testDest
    gwhost: sap.example.com
    gwport: 3300
    progid: QUICKSTART
    connectionCount: 2
```

## Executing tests from command line

The UI tests are disabled by default. To enable them you need to set

    -DskipUITests=false

It is also recommended to ignore local artifacts

    -Dtycho.localArtifacts=ignore

You may also get errors from baseline comparison, so disable it

    -Dtycho.baseline=disable
    -DskipBaselineComparison=true

The final command should look like

    mvn clean verify -pl uitests/tests/org.jboss.tools.fuse.sap.ui.bot.tests -am \
    	-DskipUITests=false \
    	-Dtycho.localArtifacts=ignore \
    	-Dtycho.baseline=disable \
    	-DskipBaselineComparison=true \
    	-DfailIfNoTests=false \
    	-Dtest.sapRepository=<UPDATE_SITE_WITH_SAP_BUNDLES> \
    	-Drd.config=<SAP_CONFIGURATION_YAML_OR_JSON> \
    	-Dtest=SmokeTests

## Executing tests against an existing Eclipse instance

    -Dtest.installBase=${ECLIPSE_HOME}
    -Dtest.installBase=${DEVSTUDIO_HOME}/studio

## Debugging tests when running from command line

Just add the following system property

    -DdebugPort=8001

and in IDE create a configuration for Remote Java Application in Run > Debug Configurations...

## Executing tests from IDE

Current version of JBoss Tools Fuse SAP is built on Eclipse Oxygen, so download Eclipse Oxygen for JEE Developers. There are two ways how we can execute the tests from IDE
1. Importing all jbosstools-fuse-extras plugins and setting the appropriate target platform
2. Install all needed dependencies into Eclipse IDE and import only the test plugins

### Executing tests from IDE with a target platform

1. Install RedDeer 2.x (at least UI Tools), e.g. from http://download.eclipse.org/reddeer/releases/2.0.0/
2. Import the project as Existing Projects into Workspace
3. Check 'Search for nested projects' and select all projects
4. In preferences go to Plug-in Development > Target Platform
5. Add empty target definition and include the Target Platform as a directory
6. In preferences also allow forbidden references (Java > Compiler > Errors/Warnings)
8. After restart you should see a launcher called 'RedDeer SAP Test'
9. Run the launcher (at the moment it takes about 2 minutes to run the tests)

### Executing tests from IDE without target platform

1. Install JBoss Fuse Tools, e.g from http://download.jboss.org/jbosstools/oxygen/staging/updates/
1. Install JBoss Fuse SAP Tooling via the Import wizard
2. Install RedDeer 2.x, e.g. from http://download.eclipse.org/reddeer/releases/2.0.0/
3. Import the tests as Existing Projects into Workspace
4. Now, we can launch 'RedDeer SAP Test' which is available in Run configuration
